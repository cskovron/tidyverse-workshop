<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="dcterms.date" content="2018-07-16" />
  <title>Introduction to the tidyverse: data manipulation with dplyr</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="part2_dplyr_files/reveal.js-3.3.0.1/css/reveal.css"/>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */
</style>

<link rel="stylesheet" href="part2_dplyr_files/reveal.js-3.3.0.1/css/theme/simple.css" id="theme">


  <!-- some tweaks to reveal css -->
  <style type="text/css">
    .reveal h1 { font-size: 2.0em; }
    .reveal h2 { font-size: 1.5em;  }
    .reveal h3 { font-size: 1.25em;	}
    .reveal h4 { font-size: 1em;	}

    .reveal .slides>section,
    .reveal .slides>section>section {
      padding: 0px 0px;
    }



    .reveal table {
      border-width: 1px;
      border-spacing: 2px;
      border-style: dotted;
      border-color: gray;
      border-collapse: collapse;
      font-size: 0.7em;
    }

    .reveal table th {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      font-weight: bold;
      border-style: dotted;
      border-color: gray;
    }

    .reveal table td {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      border-style: dotted;
      border-color: gray;
    }


  </style>

    <style type="text/css">code{white-space: pre;}</style>


<!-- Printing and PDF exports -->
<script id="paper-css" type="application/dynamic-css">

/* Default Print Stylesheet Template
   by Rob Glazebrook of CSSnewbie.com
   Last Updated: June 4, 2008

   Feel free (nay, compelled) to edit, append, and
   manipulate this file as you see fit. */


@media print {

	/* SECTION 1: Set default width, margin, float, and
	   background. This prevents elements from extending
	   beyond the edge of the printed page, and prevents
	   unnecessary background images from printing */
	html {
		background: #fff;
		width: auto;
		height: auto;
		overflow: visible;
	}
	body {
		background: #fff;
		font-size: 20pt;
		width: auto;
		height: auto;
		border: 0;
		margin: 0 5%;
		padding: 0;
		overflow: visible;
		float: none !important;
	}

	/* SECTION 2: Remove any elements not needed in print.
	   This would include navigation, ads, sidebars, etc. */
	.nestedarrow,
	.controls,
	.fork-reveal,
	.share-reveal,
	.state-background,
	.reveal .progress,
	.reveal .backgrounds {
		display: none !important;
	}

	/* SECTION 3: Set body font face, size, and color.
	   Consider using a serif font for readability. */
	body, p, td, li, div {
		font-size: 20pt!important;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		color: #000;
	}

	/* SECTION 4: Set heading font face, sizes, and color.
	   Differentiate your headings from your body text.
	   Perhaps use a large sans-serif for distinction. */
	h1,h2,h3,h4,h5,h6 {
		color: #000!important;
		height: auto;
		line-height: normal;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		text-shadow: 0 0 0 #000 !important;
		text-align: left;
		letter-spacing: normal;
	}
	/* Need to reduce the size of the fonts for printing */
	h1 { font-size: 28pt !important;  }
	h2 { font-size: 24pt !important; }
	h3 { font-size: 22pt !important; }
	h4 { font-size: 22pt !important; font-variant: small-caps; }
	h5 { font-size: 21pt !important; }
	h6 { font-size: 20pt !important; font-style: italic; }

	/* SECTION 5: Make hyperlinks more usable.
	   Ensure links are underlined, and consider appending
	   the URL to the end of the link for usability. */
	a:link,
	a:visited {
		color: #000 !important;
		font-weight: bold;
		text-decoration: underline;
	}
	/*
	.reveal a:link:after,
	.reveal a:visited:after {
		content: " (" attr(href) ") ";
		color: #222 !important;
		font-size: 90%;
	}
	*/


	/* SECTION 6: more reveal.js specific additions by @skypanther */
	ul, ol, div, p {
		visibility: visible;
		position: static;
		width: auto;
		height: auto;
		display: block;
		overflow: visible;
		margin: 0;
		text-align: left !important;
	}
	.reveal pre,
	.reveal table {
		margin-left: 0;
		margin-right: 0;
	}
	.reveal pre code {
		padding: 20px;
		border: 1px solid #ddd;
	}
	.reveal blockquote {
		margin: 20px 0;
	}
	.reveal .slides {
		position: static !important;
		width: auto !important;
		height: auto !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 0 !important;
		zoom: 1 !important;

		overflow: visible !important;
		display: block !important;

		text-align: left !important;
		-webkit-perspective: none;
		   -moz-perspective: none;
		    -ms-perspective: none;
		        perspective: none;

		-webkit-perspective-origin: 50% 50%;
		   -moz-perspective-origin: 50% 50%;
		    -ms-perspective-origin: 50% 50%;
		        perspective-origin: 50% 50%;
	}
	.reveal .slides section {
		visibility: visible !important;
		position: static !important;
		width: auto !important;
		height: auto !important;
		display: block !important;
		overflow: visible !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 60px 20px !important;
		z-index: auto !important;

		opacity: 1 !important;

		page-break-after: always !important;

		-webkit-transform-style: flat !important;
		   -moz-transform-style: flat !important;
		    -ms-transform-style: flat !important;
		        transform-style: flat !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;

		-webkit-transition: none !important;
		   -moz-transition: none !important;
		    -ms-transition: none !important;
		        transition: none !important;
	}
	.reveal .slides section.stack {
		padding: 0 !important;
	}
	.reveal section:last-of-type {
		page-break-after: avoid !important;
	}
	.reveal section .fragment {
		opacity: 1 !important;
		visibility: visible !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;
	}
	.reveal section img {
		display: block;
		margin: 15px 0px;
		background: rgba(255,255,255,1);
		border: 1px solid #666;
		box-shadow: none;
	}

	.reveal section small {
		font-size: 0.8em;
	}

}  
</script>


<script id="pdf-css" type="application/dynamic-css">
    
/**
 * This stylesheet is used to print reveal.js
 * presentations to PDF.
 *
 * https://github.com/hakimel/reveal.js#pdf-export
 */

* {
	-webkit-print-color-adjust: exact;
}

body {
	margin: 0 auto !important;
	border: 0;
	padding: 0;
	float: none !important;
	overflow: visible;
}

html {
	width: 100%;
	height: 100%;
	overflow: visible;
}

/* Remove any elements not needed in print. */
.nestedarrow,
.reveal .controls,
.reveal .progress,
.reveal .playback,
.reveal.overview,
.fork-reveal,
.share-reveal,
.state-background {
	display: none !important;
}

h1, h2, h3, h4, h5, h6 {
	text-shadow: 0 0 0 #000 !important;
}

.reveal pre code {
	overflow: hidden !important;
	font-family: Courier, 'Courier New', monospace !important;
}

ul, ol, div, p {
	visibility: visible;
	position: static;
	width: auto;
	height: auto;
	display: block;
	overflow: visible;
	margin: auto;
}
.reveal {
	width: auto !important;
	height: auto !important;
	overflow: hidden !important;
}
.reveal .slides {
	position: static;
	width: 100%;
	height: auto;

	left: auto;
	top: auto;
	margin: 0 !important;
	padding: 0 !important;

	overflow: visible;
	display: block;

	-webkit-perspective: none;
	   -moz-perspective: none;
	    -ms-perspective: none;
	        perspective: none;

	-webkit-perspective-origin: 50% 50%; /* there isn't a none/auto value but 50-50 is the default */
	   -moz-perspective-origin: 50% 50%;
	    -ms-perspective-origin: 50% 50%;
	        perspective-origin: 50% 50%;
}

.reveal .slides section {
	page-break-after: always !important;

	visibility: visible !important;
	position: relative !important;
	display: block !important;
	position: relative !important;

	margin: 0 !important;
	padding: 0 !important;
	box-sizing: border-box !important;
	min-height: 1px;

	opacity: 1 !important;

	-webkit-transform-style: flat !important;
	   -moz-transform-style: flat !important;
	    -ms-transform-style: flat !important;
	        transform-style: flat !important;

	-webkit-transform: none !important;
	   -moz-transform: none !important;
	    -ms-transform: none !important;
	        transform: none !important;
}

.reveal section.stack {
	margin: 0 !important;
	padding: 0 !important;
	page-break-after: avoid !important;
	height: auto !important;
	min-height: auto !important;
}

.reveal img {
	box-shadow: none;
}

.reveal .roll {
	overflow: visible;
	line-height: 1em;
}

/* Slide backgrounds are placed inside of their slide when exporting to PDF */
.reveal section .slide-background {
	display: block !important;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	z-index: -1;
}

/* All elements should be above the slide-background */
.reveal section>* {
	position: relative;
	z-index: 1;
}

/* Display slide speaker notes when 'showNotes' is enabled */
.reveal .speaker-notes-pdf {
	display: block;
	width: 100%;
	max-height: none;
	left: auto;
	top: auto;
	z-index: 100;
}

/* Display slide numbers when 'slideNumber' is enabled */
.reveal .slide-number-pdf {
	display: block;
	position: absolute;
	font-size: 14px;
}

</script>


<script>
var style = document.createElement( 'style' );
style.type = 'text/css';
var style_script_id = window.location.search.match( /print-pdf/gi ) ? 'pdf-css' : 'paper-css';
var style_script = document.getElementById(style_script_id).text;
style.innerHTML = style_script;
document.getElementsByTagName('head')[0].appendChild(style);
</script>

</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
    <h1 class="title">Introduction to the tidyverse: data manipulation with <code>dplyr</code></h1>
    <h2 class="author"><div style="white-space: pre-line;">Christopher Skovron
Northwestern University</div></h2>
    <h3 class="date">July 16, 2018</h3>
</section>

<section id="dplyr-data-manipulation" class="slide level2">
<h2>dplyr: data manipulation</h2>
</section>
<section id="dplyr-is-the-main-workhorse-of-the-tidyverse" class="slide level2">
<h2>dplyr is the main workhorse of the tidyverse</h2>
<p>This lesson draws on <a href="http://r4ds.had.co.nz/transform.html">Chapter 5 of R for Data Science</a>. For a condensed version, check out the <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html">Introduction to dplyr</a> vignette.</p>
</section>
<section id="example-data-nycflights13" class="slide level2">
<h2>Example data: nycflights13</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(c(&#39;nycflights13&#39;, &#39;tidyverse&#39;))</span>
<span class="kw">library</span>(nycflights13)
<span class="kw">library</span>(tidyverse)</code></pre></div>
<pre><code>## ── Attaching packages ─────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 2.2.1     ✔ purrr   0.2.5
## ✔ tibble  1.4.2     ✔ dplyr   0.7.5
## ✔ tidyr   0.8.1     ✔ stringr 1.3.1
## ✔ readr   1.1.1     ✔ forcats 0.3.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
</section>
<section id="note-conflicts-when-you-load-the-tidyverse" class="slide level2">
<h2>Note conflicts when you load the tidyverse</h2>
<p>Take careful note of the conflicts message that’s printed when you load the tidyverse. It tells you that dplyr overwrites some functions in base R. If you want to use the base version of these functions after loading dplyr, you’ll need to use their full names: <code>stats::filter()</code> and <code>stats::lag()</code>.</p>
</section>
<section id="nycflights13" class="slide level2">
<h2>nycflights13</h2>
<p>Example data: <code>nycflights13::flights</code>. This data frame contains all 336,776 flights that departed from New York City in 2013.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</section>
<section id="it-prints-as-a-tibble" class="slide level2">
<h2>It prints as a tibble</h2>
<p>You might also have noticed the row of three (or four) letter abbreviations under the column names. These describe the type of each variable:</p>
<ul>
<li><p><code>int</code> stands for integers.</p></li>
<li><p><code>dbl</code> stands for doubles, or real numbers.</p></li>
<li><p><code>chr</code> stands for character vectors, or strings.</p></li>
<li><p><code>dttm</code> stands for date-times (a date + a time).</p></li>
</ul>
</section>
<section id="other-kinds-of-variables-you-may-see-in-a-tibble" class="slide level2">
<h2>Other kinds of variables you may see in a tibble</h2>
<ul>
<li><p><code>lgl</code> stands for logical, vectors that contain only <code>TRUE</code> or <code>FALSE</code>.</p></li>
<li><p><code>fctr</code> stands for factors, which R uses to represent categorical variables with fixed possible values.</p></li>
<li><p><code>date</code> stands for dates.</p></li>
</ul>
</section>
<section id="dplyr-verbs" class="slide level2">
<h2>dplyr verbs</h2>
<ul>
<li>Pick observations by their values (<code>filter()</code>).</li>
<li>Reorder the rows (<code>arrange()</code>).</li>
<li>Pick variables by their names (<code>select()</code>).</li>
<li>Create new variables with functions of existing variables (<code>mutate()</code>).</li>
<li>Collapse many values down to a single summary (<code>summarise()</code>).</li>
</ul>
</section>
<section id="we-will-frequently-used-these-on-grouped-data" class="slide level2">
<h2>We will frequently used these on grouped data</h2>
<p>These can all be used in conjunction with <code>group_by()</code> which changes the scope of each function from operating on the entire dataset to operating on it group-by-group. These six functions provide the verbs for a language of data manipulation.</p>
</section>
<section id="how-dplyr-verbs-work" class="slide level2">
<h2>How dplyr verbs work</h2>
<p>All verbs work similarly:</p>
<ol type="1">
<li><p>The first argument is a data frame.</p></li>
<li><p>The subsequent arguments describe what to do with the data frame, using the variable names (without quotes).</p></li>
<li><p>The result is a new data frame.</p></li>
</ol>
<p>Together these properties make it easy to chain together multiple simple steps to achieve a complex result. Let’s dive in and see how these verbs work.</p>
</section>
<section id="choose-rows-with-filter" class="slide level2">
<h2>Choose rows with <code>filter()</code></h2>
<p>For example, we can select all flights on January 1st with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<pre><code>## # A tibble: 842 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 832 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</section>
<section id="choose-rows-with-filter-1" class="slide level2">
<h2>Choose rows with <code>filter()</code></h2>
<p>When you run that line of code, dplyr executes the filtering operation and returns a new data frame. dplyr functions never modify their inputs, so if you want to save the result, you’ll need to use the assignment operator, <code>&lt;-</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">jan1 &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
</section>
<section id="comparisons" class="slide level2">
<h2>Comparisons</h2>
<p>To use filtering effectively, you have to know how to select the observations that you want using the comparison operators. R provides the standard suite: <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>!=</code> (not equal), and <code>==</code> (equal).</p>
<p>Remember to use <code>=</code> instead of <code>==</code> when testing for equality. When this happens you’ll get an informative error:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, <span class="dt">month =</span> <span class="dv">1</span>)</code></pre></div>
<pre><code>## Error: `month` (`month = 1`) must not be named, do you need `==`?</code></pre>
</section>
<section id="issues-with-floating-point-numbers" class="slide level2">
<h2>Issues with floating point numbers</h2>
<p>There’s another common problem you might encounter when using <code>==</code>: floating point numbers. These results might surprise you!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sqrt</span>(<span class="dv">2</span>) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">2</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">1</span><span class="op">/</span><span class="dv">49</span> <span class="op">*</span><span class="st"> </span><span class="dv">49</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</section>
<section id="use-near-instead" class="slide level2">
<h2>Use <code>near()</code> instead</h2>
<p>Computers use finite precision arithmetic (they obviously can’t store an infinite number of digits!) so remember that every number you see is an approximation. Instead of relying on <code>==</code>, use <code>near()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">near</span>(<span class="kw">sqrt</span>(<span class="dv">2</span>) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>,  <span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">near</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">49</span> <span class="op">*</span><span class="st"> </span><span class="dv">49</span>, <span class="dv">1</span>)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</section>
<section id="logical-operators" class="slide level2">
<h2>Logical operators</h2>
<p>Multiple arguments to <code>filter()</code> are combined with “and”: every expression must be true in order for a row to be included in the output. For other types of combinations, you’ll need to use Boolean operators yourself: <code>&amp;</code> is “and”, <code>|</code> is “or”, and <code>!</code> is “not”.</p>
</section>
<section id="find-all-flights-that-departed-in-november-or-december" class="slide level2">
<h2>Find all flights that departed in November or December:</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">11</span> <span class="op">|</span><span class="st"> </span>month <span class="op">==</span><span class="st"> </span><span class="dv">12</span>)</code></pre></div>
</section>
<section id="another-way-to-write-it-using-in" class="slide level2">
<h2>Another way to write it using <code>%in%</code></h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nov_dec &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">11</span>, <span class="dv">12</span>))</code></pre></div>
<p>Sometimes you can simplify complicated subsetting by remembering De Morgan’s law: <code>!(x &amp; y)</code> is the same as <code>!x | !y</code>, and <code>!(x | y)</code> is the same as <code>!x &amp; !y</code>. For example, if you wanted to find flights that weren’t delayed (on arrival or departure) by more than two hours, you could use either of the following two filters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, <span class="op">!</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span> <span class="op">|</span><span class="st"> </span>dep_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>))
<span class="kw">filter</span>(flights, arr_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">120</span>, dep_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">120</span>)</code></pre></div>
</section>
<section id="missing-values" class="slide level2">
<h2>Missing values</h2>
<p>If you want to determine if a value is missing, use <code>is.na()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.na</span>(x)</code></pre></div>
<p><code>filter()</code> only includes rows where the condition is <code>TRUE</code>; it excludes both <code>FALSE</code> and <code>NA</code> values. If you want to preserve missing values, ask for them explicitly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">3</span>))
<span class="kw">filter</span>(df, x <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       x
##   &lt;dbl&gt;
## 1     3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(df, <span class="kw">is.na</span>(x) <span class="op">|</span><span class="st"> </span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<pre><code>## # A tibble: 2 x 1
##       x
##   &lt;dbl&gt;
## 1    NA
## 2     3</code></pre>
</section>
<section id="arrange-rows-with-arrange" class="slide level2">
<h2>Arrange rows with <code>arrange()</code></h2>
<p><code>arrange()</code> changes the order of rows order. It takes a data frame and a set of column names (or more complicated expressions) to order by. If you provide more than one column name, each additional column will be used to break ties in the values of preceding columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, year, month, day)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</section>
<section id="arrange-rows-with-arrange-1" class="slide level2">
<h2>Arrange rows with <code>arrange()</code></h2>
<p>Use <code>desc()</code> to re-order by a column in descending order:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(arr_delay))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242
##  2  2013     6    15     1432           1935      1137     1607
##  3  2013     1    10     1121           1635      1126     1239
##  4  2013     9    20     1139           1845      1014     1457
##  5  2013     7    22      845           1600      1005     1044
##  6  2013     4    10     1100           1900       960     1342
##  7  2013     3    17     2321            810       911      135
##  8  2013     7    22     2257            759       898      121
##  9  2013    12     5      756           1700       896     1058
## 10  2013     5     3     1133           2055       878     1250
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</section>
<section id="arrange-rows-with-arrange-2" class="slide level2">
<h2>Arrange rows with <code>arrange()</code></h2>
<p>Missing values are always sorted at the end:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="ot">NA</span>))
<span class="kw">arrange</span>(df, x)</code></pre></div>
<pre><code>## # A tibble: 3 x 1
##       x
##   &lt;dbl&gt;
## 1     2
## 2     5
## 3    NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(df, <span class="kw">desc</span>(x))</code></pre></div>
<pre><code>## # A tibble: 3 x 1
##       x
##   &lt;dbl&gt;
## 1     5
## 2     2
## 3    NA</code></pre>
</section>
<section id="exercise" class="slide level2">
<h2>Exercise</h2>
<ol type="1">
<li>Sort <code>flights</code> to find the fastest flights.</li>
</ol>
</section>
<section id="solution" class="slide level2">
<h2>Solution</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(air_time)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1    16     1355           1315        40     1442
##  2  2013     4    13      537            527        10      622
##  3  2013    12     6      922            851        31     1021
##  4  2013     2     3     2153           2129        24     2247
##  5  2013     2     5     1303           1315       -12     1342
##  6  2013     2    12     2123           2130        -7     2211
##  7  2013     3     2     1450           1500       -10     1547
##  8  2013     3     8     2026           1935        51     2131
##  9  2013     3    18     1456           1329        87     1533
## 10  2013     3    19     2226           2145        41     2305
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</section>
<section id="select-columns-with-select" class="slide level2">
<h2>Select columns with <code>select()</code></h2>
<p><code>select()</code> chooses the columns you want out of the whole set of columns</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Select columns by name</span>
<span class="kw">select</span>(flights, year, month, day)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows</code></pre>
</section>
<section id="select-columns-with-select-1" class="slide level2">
<h2>Select columns with <code>select()</code></h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Select all columns between year and day (inclusive)</span>
<span class="kw">select</span>(flights, year<span class="op">:</span>day)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows</code></pre>
</section>
<section id="select-columns-with-select-2" class="slide level2">
<h2>Select columns with <code>select()</code></h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Select all columns except those from year to day (inclusive)</span>
<span class="kw">select</span>(flights, <span class="op">-</span>(year<span class="op">:</span>day))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 16
##    dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
##  1      517            515         2      830            819        11
##  2      533            529         4      850            830        20
##  3      542            540         2      923            850        33
##  4      544            545        -1     1004           1022       -18
##  5      554            600        -6      812            837       -25
##  6      554            558        -4      740            728        12
##  7      555            600        -5      913            854        19
##  8      557            600        -3      709            723       -14
##  9      557            600        -3      838            846        -8
## 10      558            600        -2      753            745         8
## # ... with 336,766 more rows, and 10 more variables: carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</section>
<section id="helpers-for-select" class="slide level2">
<h2>Helpers for <code>select()</code></h2>
<p>There are a number of helper functions you can use within <code>select()</code>:</p>
<ul>
<li><p><code>starts_with(&quot;abc&quot;)</code>: matches names that begin with “abc”.</p></li>
<li><p><code>ends_with(&quot;xyz&quot;)</code>: matches names that end with “xyz”.</p></li>
<li><p><code>contains(&quot;ijk&quot;)</code>: matches names that contain “ijk”.</p></li>
<li><p><code>matches(&quot;(.)\\1&quot;)</code>: selects variables that match a regular expression. This one matches any variables that contain repeated characters. You’ll learn more about regular expressions in [strings].</p></li>
<li><p><code>num_range(&quot;x&quot;, 1:3)</code> matches <code>x1</code>, <code>x2</code> and <code>x3</code>.</p></li>
</ul>
</section>
<section id="use-rename-to-rename-variables" class="slide level2">
<h2>Use <code>rename()</code> to rename variables</h2>
<p><code>select()</code> can be used to rename variables, but it’s rarely useful because it drops all of the variables not explicitly mentioned. Instead, use <code>rename()</code>, which is a variant of <code>select()</code> that keeps all the variables that aren’t explicitly mentioned:</p>
</section>
<section id="use-rename-to-rename-variables-1" class="slide level2">
<h2>Use <code>rename()</code> to rename variables</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rename</span>(flights, <span class="dt">tail_num =</span> tailnum)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tail_num &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p><em>Note that it’s new_name = old_name. This always throws me off.</em></p>
</section>
<section id="add-new-variables-with-mutate" class="slide level2">
<h2>Add new variables with <code>mutate()</code></h2>
<p>Besides selecting sets of existing columns, it’s often useful to add new columns that are functions of existing columns. That’s the job of <code>mutate()</code>.</p>
</section>
<section id="make-a-smaller-version-of-the-dataset-so-we-can-see-our-work" class="slide level2">
<h2>Make a smaller version of the dataset so we can see our work</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_sml &lt;-<span class="st"> </span><span class="kw">select</span>(flights, 
  year<span class="op">:</span>day, 
  <span class="kw">ends_with</span>(<span class="st">&quot;delay&quot;</span>), 
  distance, 
  air_time
)</code></pre></div>
</section>
<section id="add-new-variables-with-mutate-1" class="slide level2">
<h2>Add new variables with <code>mutate()</code></h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(flights_sml,
  <span class="dt">gain =</span> arr_delay <span class="op">-</span><span class="st"> </span>dep_delay,
  <span class="dt">speed =</span> distance <span class="op">/</span><span class="st"> </span>air_time <span class="op">*</span><span class="st"> </span><span class="dv">60</span>
)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 9
##     year month   day dep_delay arr_delay distance air_time  gain speed
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1         2        11     1400      227     9  370.
##  2  2013     1     1         4        20     1416      227    16  374.
##  3  2013     1     1         2        33     1089      160    31  408.
##  4  2013     1     1        -1       -18     1576      183   -17  517.
##  5  2013     1     1        -6       -25      762      116   -19  394.
##  6  2013     1     1        -4        12      719      150    16  288.
##  7  2013     1     1        -5        19     1065      158    24  404.
##  8  2013     1     1        -3       -14      229       53   -11  259.
##  9  2013     1     1        -3        -8      944      140    -5  405.
## 10  2013     1     1        -2         8      733      138    10  319.
## # ... with 336,766 more rows</code></pre>
</section>
<section id="add-new-variables-with-mutate-2" class="slide level2">
<h2>Add new variables with <code>mutate()</code></h2>
<p>Note that you can refer to columns that you’ve just created:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(flights_sml,
  <span class="dt">gain =</span> arr_delay <span class="op">-</span><span class="st"> </span>dep_delay,
  <span class="dt">hours =</span> air_time <span class="op">/</span><span class="st"> </span><span class="dv">60</span>,
  <span class="dt">gain_per_hour =</span> gain <span class="op">/</span><span class="st"> </span>hours
)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 10
##     year month   day dep_delay arr_delay distance air_time  gain hours
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1         2        11     1400      227     9 3.78 
##  2  2013     1     1         4        20     1416      227    16 3.78 
##  3  2013     1     1         2        33     1089      160    31 2.67 
##  4  2013     1     1        -1       -18     1576      183   -17 3.05 
##  5  2013     1     1        -6       -25      762      116   -19 1.93 
##  6  2013     1     1        -4        12      719      150    16 2.5  
##  7  2013     1     1        -5        19     1065      158    24 2.63 
##  8  2013     1     1        -3       -14      229       53   -11 0.883
##  9  2013     1     1        -3        -8      944      140    -5 2.33 
## 10  2013     1     1        -2         8      733      138    10 2.3  
## # ... with 336,766 more rows, and 1 more variable: gain_per_hour &lt;dbl&gt;</code></pre>
</section>
<section id="add-new-variables-with-mutate-3" class="slide level2">
<h2>Add new variables with <code>mutate()</code></h2>
<p>If you only want to keep the new variables, use <code>transmute()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">transmute</span>(flights,
  <span class="dt">gain =</span> arr_delay <span class="op">-</span><span class="st"> </span>dep_delay,
  <span class="dt">hours =</span> air_time <span class="op">/</span><span class="st"> </span><span class="dv">60</span>,
  <span class="dt">gain_per_hour =</span> gain <span class="op">/</span><span class="st"> </span>hours
)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     gain hours gain_per_hour
##    &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
##  1     9 3.78           2.38
##  2    16 3.78           4.23
##  3    31 2.67          11.6 
##  4   -17 3.05          -5.57
##  5   -19 1.93          -9.83
##  6    16 2.5            6.4 
##  7    24 2.63           9.11
##  8   -11 0.883        -12.5 
##  9    -5 2.33          -2.14
## 10    10 2.3            4.35
## # ... with 336,766 more rows</code></pre>
<p>There are many functions for creating new variables that you can use with <code>mutate()</code>. The key property is that the function must be vectorised: it must take a vector of values as input, return a vector with the same number of values as output. There’s no way to list every possible function that you might use, but here’s a selection of functions that are frequently useful:</p>
<ul>
<li>Logical comparisons, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>!=</code>, which you learned about earlier. If you’re doing a complex sequence of logical operations it’s often a good idea to store the interim values in new variables so you can check that each step is working as expected.</li>
</ul>
</section>
<section id="useful-helpers-for-mutate" class="slide level2">
<h2>Useful helpers for <code>mutate()</code></h2>
<ul>
<li><p>Ranking: there are a number of ranking functions, but you should start with <code>min_rank()</code>. It does the most usual type of ranking (e.g. 1st, 2nd, 2nd, 4th). The default gives smallest values the small ranks; use <code>desc(x)</code> to give the largest values the smallest ranks.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="ot">NA</span>, <span class="dv">3</span>, <span class="dv">4</span>)
<span class="kw">min_rank</span>(y)</code></pre></div>
<pre><code>## [1]  1  2  2 NA  4  5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">min_rank</span>(<span class="kw">desc</span>(y))</code></pre></div>
<pre><code>## [1]  5  3  3 NA  2  1</code></pre></li>
</ul>
</section>
<section id="useful-helpers-for-mutate-1" class="slide level2">
<h2>Useful helpers for <code>mutate()</code></h2>
<p>If <code>min_rank()</code> doesn’t do what you need, look at the variants <code>row_number()</code>, <code>dense_rank()</code>, <code>percent_rank()</code>, <code>cume_dist()</code>, <code>ntile()</code>. See their help pages for more details.</p>
<pre><code>```r
row_number(y)
```

```
## [1]  1  2  3 NA  4  5
```

```r
dense_rank(y)
```

```
## [1]  1  2  2 NA  3  4
```

```r
percent_rank(y)
```

```
## [1] 0.00 0.25 0.25   NA 0.75 1.00
```

```r
cume_dist(y)
```

```
## [1] 0.2 0.6 0.6  NA 0.8 1.0
```</code></pre>
</section>
<section id="grouped-summaries-with-summarise" class="slide level2">
<h2>Grouped summaries with <code>summarise()</code></h2>
<p>The last key verb is <code>summarise()</code>. It collapses a data frame to a single row:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarise</span>(flights, <span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   delay
##   &lt;dbl&gt;
## 1  12.6</code></pre>
</section>
<section id="grouped-summaries-with-summarise-1" class="slide level2">
<h2>Grouped summaries with <code>summarise()</code></h2>
<p><code>summarise()</code> is not terribly useful unless we pair it with <code>group_by()</code>. This changes the unit of analysis from the complete dataset to individual groups. Then, when you use the dplyr verbs on a grouped data frame they’ll be automatically applied “by group”. For example, if we applied exactly the same code to a data frame grouped by date, we get the average delay per date:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">by_day &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, year, month, day)
<span class="kw">summarise</span>(by_day, <span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [?]
##     year month   day delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.5 
##  2  2013     1     2 13.9 
##  3  2013     1     3 11.0 
##  4  2013     1     4  8.95
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.55
##  9  2013     1     9  2.28
## 10  2013     1    10  2.84
## # ... with 355 more rows</code></pre>
<h3 id="missing-values-1">Missing values</h3>
<p>You may have wondered about the <code>na.rm</code> argument we used above. What happens if we don’t set it?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay))</code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [?]
##     year month   day  mean
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1    NA
##  2  2013     1     2    NA
##  3  2013     1     3    NA
##  4  2013     1     4    NA
##  5  2013     1     5    NA
##  6  2013     1     6    NA
##  7  2013     1     7    NA
##  8  2013     1     8    NA
##  9  2013     1     9    NA
## 10  2013     1    10    NA
## # ... with 355 more rows</code></pre>
</section>
<section id="missing-values-2" class="slide level2">
<h2>Missing values</h2>
<p>We get a lot of missing values! That’s because aggregation functions obey the usual rule of missing values: if there’s any missing value in the input, the output will be a missing value. Fortunately, all aggregation functions have an <code>na.rm</code> argument which removes the missing values prior to computation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [?]
##     year month   day  mean
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.5 
##  2  2013     1     2 13.9 
##  3  2013     1     3 11.0 
##  4  2013     1     4  8.95
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.55
##  9  2013     1     9  2.28
## 10  2013     1    10  2.84
## # ... with 355 more rows</code></pre>
</section>
<section id="missing-values-3" class="slide level2">
<h2>Missing values</h2>
<p>In this case, where missing values represent cancelled flights, we could also tackle the problem by first removing the cancelled flights. We’ll save this dataset so we can reuse in the next few examples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_cancelled &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_delay), <span class="op">!</span><span class="kw">is.na</span>(arr_delay))

not_cancelled <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay))</code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [?]
##     year month   day  mean
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.4 
##  2  2013     1     2 13.7 
##  3  2013     1     3 10.9 
##  4  2013     1     4  8.97
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.56
##  9  2013     1     9  2.30
## 10  2013     1    10  2.84
## # ... with 355 more rows</code></pre>
</section>
<section id="counts" class="slide level2">
<h2>Counts</h2>
<p>Whenever you do any aggregation, it’s always a good idea to include either a count (<code>n()</code>), or a count of non-missing values (<code>sum(!is.na(x))</code>). That way you can check that you’re not drawing conclusions based on very small amounts of data. For example, let’s look at the planes (identified by their tail number) that have the highest average delays:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">delays &lt;-<span class="st"> </span>not_cancelled <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay)
  )

<span class="kw">ggplot</span>(<span class="dt">data =</span> delays, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> delay)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>)</code></pre></div>
<p><img src="part2_dplyr_files/figure-revealjs/unnamed-chunk-32-1.png" width="768" /></p>
</section>
<section id="exercise-1" class="slide level2">
<h2>Exercise</h2>
<ol type="1">
<li><p>Find all flights that</p>
<ol type="1">
<li>Had an arrival delay of two or more hours</li>
<li>Flew to Houston (<code>IAH</code> or <code>HOU</code>)</li>
<li>Were operated by United, American, or Delta</li>
<li>Departed in summer (July, August, and September)</li>
</ol></li>
</ol>
</section>
<section id="grouped-summaries" class="slide level2">
<h2>Grouped summaries</h2>
</section>
<section id="counts-1" class="slide level2">
<h2>Counts</h2>
<p>You’ve seen <code>n()</code>, which takes no arguments, and returns the size of the current group. To count the number of non-missing values, use <code>sum(!is.na(x))</code>. To count the number of distinct (unique) values, use <code>n_distinct(x)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">    <span class="co"># Which destinations have the most carriers?</span>
    not_cancelled <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">summarise</span>(<span class="dt">carriers =</span> <span class="kw">n_distinct</span>(carrier)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">arrange</span>(<span class="kw">desc</span>(carriers))</code></pre></div>
<pre><code>## # A tibble: 104 x 2
##    dest  carriers
##    &lt;chr&gt;    &lt;int&gt;
##  1 ATL          7
##  2 BOS          7
##  3 CLT          7
##  4 ORD          7
##  5 TPA          7
##  6 AUS          6
##  7 DCA          6
##  8 DTW          6
##  9 IAD          6
## 10 MSP          6
## # ... with 94 more rows</code></pre>
</section>
<section id="counts-2" class="slide level2">
<h2>Counts</h2>
<p>Counts are so useful that dplyr provides a simple helper if all you want is a count:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">    not_cancelled <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">count</span>(dest)</code></pre></div>
<pre><code>## # A tibble: 104 x 2
##    dest      n
##    &lt;chr&gt; &lt;int&gt;
##  1 ABQ     254
##  2 ACK     264
##  3 ALB     418
##  4 ANC       8
##  5 ATL   16837
##  6 AUS    2411
##  7 AVL     261
##  8 BDL     412
##  9 BGR     358
## 10 BHM     269
## # ... with 94 more rows</code></pre>
</section>
<section id="counts-3" class="slide level2">
<h2>Counts</h2>
<p>You can optionally provide a weight variable. For example, you could use this to “count” (sum) the total number of miles a plane flew:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">    not_cancelled <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">count</span>(tailnum, <span class="dt">wt =</span> distance)</code></pre></div>
<pre><code>## # A tibble: 4,037 x 2
##    tailnum      n
##    &lt;chr&gt;    &lt;dbl&gt;
##  1 D942DN    3418
##  2 N0EGMQ  239143
##  3 N10156  109664
##  4 N102UW   25722
##  5 N103US   24619
##  6 N104UW   24616
##  7 N10575  139903
##  8 N105UW   23618
##  9 N107US   21677
## 10 N108UW   32070
## # ... with 4,027 more rows</code></pre>
</section>
<section id="counts-4" class="slide level2">
<h2>Counts</h2>
<p>Counts and proportions of logical values: <code>sum(x &gt; 10)</code>, <code>mean(y == 0)</code>. When used with numeric functions, <code>TRUE</code> is converted to 1 and <code>FALSE</code> to 0. This makes <code>sum()</code> and <code>mean()</code> very useful: <code>sum(x)</code> gives the number of <code>TRUE</code>s in <code>x</code>, and <code>mean(x)</code> gives the proportion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">    <span class="co"># How many flights left before 5am? (these usually indicate delayed</span>
    <span class="co"># flights from the previous day)</span>
    not_cancelled <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">summarise</span>(<span class="dt">n_early =</span> <span class="kw">sum</span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="dv">500</span>))</code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [?]
##     year month   day n_early
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;
##  1  2013     1     1       0
##  2  2013     1     2       3
##  3  2013     1     3       4
##  4  2013     1     4       3
##  5  2013     1     5       3
##  6  2013     1     6       2
##  7  2013     1     7       2
##  8  2013     1     8       1
##  9  2013     1     9       3
## 10  2013     1    10       3
## # ... with 355 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">    <span class="co"># What proportion of flights are delayed by more than an hour?</span>
    not_cancelled <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">summarise</span>(<span class="dt">hour_perc =</span> <span class="kw">mean</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">60</span>))</code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [?]
##     year month   day hour_perc
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;
##  1  2013     1     1    0.0722
##  2  2013     1     2    0.0851
##  3  2013     1     3    0.0567
##  4  2013     1     4    0.0396
##  5  2013     1     5    0.0349
##  6  2013     1     6    0.0470
##  7  2013     1     7    0.0333
##  8  2013     1     8    0.0213
##  9  2013     1     9    0.0202
## 10  2013     1    10    0.0183
## # ... with 355 more rows</code></pre>
</section>
<section id="grouping-by-multiple-variables" class="slide level2">
<h2>Grouping by multiple variables</h2>
<p>When you group by multiple variables, each summary peels off one level of the grouping. That makes it easy to progressively roll up a dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">daily &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, year, month, day)
(per_day   &lt;-<span class="st"> </span><span class="kw">summarise</span>(daily, <span class="dt">flights =</span> <span class="kw">n</span>()))</code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [?]
##     year month   day flights
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;
##  1  2013     1     1     842
##  2  2013     1     2     943
##  3  2013     1     3     914
##  4  2013     1     4     915
##  5  2013     1     5     720
##  6  2013     1     6     832
##  7  2013     1     7     933
##  8  2013     1     8     899
##  9  2013     1     9     902
## 10  2013     1    10     932
## # ... with 355 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(per_month &lt;-<span class="st"> </span><span class="kw">summarise</span>(per_day, <span class="dt">flights =</span> <span class="kw">sum</span>(flights)))</code></pre></div>
<pre><code>## # A tibble: 12 x 3
## # Groups:   year [?]
##     year month flights
##    &lt;int&gt; &lt;int&gt;   &lt;int&gt;
##  1  2013     1   27004
##  2  2013     2   24951
##  3  2013     3   28834
##  4  2013     4   28330
##  5  2013     5   28796
##  6  2013     6   28243
##  7  2013     7   29425
##  8  2013     8   29327
##  9  2013     9   27574
## 10  2013    10   28889
## 11  2013    11   27268
## 12  2013    12   28135</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(per_year  &lt;-<span class="st"> </span><span class="kw">summarise</span>(per_month, <span class="dt">flights =</span> <span class="kw">sum</span>(flights)))</code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    year flights
##   &lt;int&gt;   &lt;int&gt;
## 1  2013  336776</code></pre>
<p>Be careful when progressively rolling up summaries: it’s OK for sums and counts, but you need to think about weighting means and variances, and it’s not possible to do it exactly for rank-based statistics like the median. In other words, the sum of groupwise sums is the overall sum, but the median of groupwise medians is not the overall median.</p>
</section>
<section id="ungrouping" class="slide level2">
<h2>Ungrouping</h2>
<p>If you need to remove grouping, and return to operations on ungrouped data, use <code>ungroup()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">daily <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st">             </span><span class="co"># no longer grouped by date</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">flights =</span> <span class="kw">n</span>())  <span class="co"># all flights</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   flights
##     &lt;int&gt;
## 1  336776</code></pre>
</section>
<section id="grouped-mutates-and-filters" class="slide level2">
<h2>Grouped mutates (and filters)</h2>
<p>Grouping is most useful in conjunction with <code>summarise()</code>, but you can also do convenient operations with <code>mutate()</code> and <code>filter()</code>:</p>
</section>
<section id="find-the-worst-members-of-each-group" class="slide level2">
<h2>Find the worst members of each group:</h2>
<pre><code>```r
flights_sml %&gt;% 
  group_by(year, month, day) %&gt;%
  filter(rank(desc(arr_delay)) &lt; 10)
```

```
## # A tibble: 3,306 x 7
## # Groups:   year, month, day [365]
##     year month   day dep_delay arr_delay distance air_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1  2013     1     1       853       851      184       41
##  2  2013     1     1       290       338     1134      213
##  3  2013     1     1       260       263      266       46
##  4  2013     1     1       157       174      213       60
##  5  2013     1     1       216       222      708      121
##  6  2013     1     1       255       250      589      115
##  7  2013     1     1       285       246     1085      146
##  8  2013     1     1       192       191      199       44
##  9  2013     1     1       379       456     1092      222
## 10  2013     1     2       224       207      550       94
## # ... with 3,296 more rows
```</code></pre>
</section>
<section id="find-all-groups-bigger-than-a-threshold" class="slide level2">
<h2>Find all groups bigger than a threshold:</h2>
<pre><code>```r
popular_dests &lt;- flights %&gt;% 
  group_by(dest) %&gt;% 
  filter(n() &gt; 365)
popular_dests
```

```
## # A tibble: 332,577 x 19
## # Groups:   dest [77]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 332,567 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```</code></pre>
</section>
<section id="standardise-to-compute-per-group-metrics" class="slide level2">
<h2>Standardise to compute per group metrics:</h2>
<pre><code>```r
popular_dests %&gt;% 
  filter(arr_delay &gt; 0) %&gt;% 
  mutate(prop_delay = arr_delay / sum(arr_delay)) %&gt;% 
  select(year:day, dest, arr_delay, prop_delay)
```

```
## # A tibble: 131,106 x 6
## # Groups:   dest [77]
##     year month   day dest  arr_delay prop_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1  2013     1     1 IAH          11  0.000111 
##  2  2013     1     1 IAH          20  0.000201 
##  3  2013     1     1 MIA          33  0.000235 
##  4  2013     1     1 ORD          12  0.0000424
##  5  2013     1     1 FLL          19  0.0000938
##  6  2013     1     1 ORD           8  0.0000283
##  7  2013     1     1 LAX           7  0.0000344
##  8  2013     1     1 DFW          31  0.000282 
##  9  2013     1     1 ATL          12  0.0000400
## 10  2013     1     1 DTW          16  0.000116 
## # ... with 131,096 more rows
```</code></pre>
</section>
<section id="exercise-2" class="slide level2">
<h2>Exercise</h2>
<ol type="1">
<li><p>Come up with another approach that will give you the same output as <code>not_cancelled %&gt;% count(dest)</code> and <code>not_cancelled %&gt;%</code> <code>count(tailnum, wt = distance)</code> (without using <code>count()</code>).</p></li>
<li><p>Which carrier has the worst delays?</p></li>
</ol>
</section>
<section id="advanced-verbs-summarize_all-summarize_at-summarize_if" class="slide level2">
<h2>Advanced verbs: <code>summarize_all()</code>, <code>summarize_at()</code>, <code>summarize_if()</code></h2>
<p>The <code>_all</code>, <code>_at</code> and <code>_if</code> suffixes work on <code>mutate</code>, <code>summarize</code>, and <code>transmute</code>. (British English speakers, you can use <code>summarise</code> too.)</p>
<ul>
<li><code>_all</code> applies the operation to all columns</li>
<li><code>_at</code> applies the operation only to named columns</li>
<li><code>_if</code> applies the operation if some condition is true</li>
</ul>
</section>
<section id="summarize_all" class="slide level2">
<h2><code>summarize_all()</code></h2>
<pre><code>```r
iris %&gt;%
  group_by(Species) %&gt;%
  summarise_all(mean)
```

```
## # A tibble: 3 x 5
##   Species    Sepal.Length Sepal.Width Petal.Length Petal.Width
##   &lt;fct&gt;             &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
## 1 setosa             5.01        3.43         1.46       0.246
## 2 versicolor         5.94        2.77         4.26       1.33 
## 3 virginica          6.59        2.97         5.55       2.03
```</code></pre>
</section>
<section id="summarize_at" class="slide level2">
<h2><code>summarize_at()</code></h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="kw">summarise_at</span>(<span class="kw">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;mass&quot;</span>), mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   height  mass
##    &lt;dbl&gt; &lt;dbl&gt;
## 1   174.  97.3</code></pre>
</section>
<section id="mutate_at-with-a-helper-to-choose-columns" class="slide level2">
<h2><code>mutate_at()</code> with a helper to choose columns</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">matches</span>(<span class="st">&quot;Sepal&quot;</span>)), log)</code></pre></div>
<pre><code>##     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
## 1       1.629241   1.2527630          1.4         0.2     setosa
## 2       1.589235   1.0986123          1.4         0.2     setosa
## 3       1.547563   1.1631508          1.3         0.2     setosa
## 4       1.526056   1.1314021          1.5         0.2     setosa
## 5       1.609438   1.2809338          1.4         0.2     setosa
## 6       1.686399   1.3609766          1.7         0.4     setosa
## 7       1.526056   1.2237754          1.4         0.3     setosa
## 8       1.609438   1.2237754          1.5         0.2     setosa
## 9       1.481605   1.0647107          1.4         0.2     setosa
## 10      1.589235   1.1314021          1.5         0.1     setosa
## 11      1.686399   1.3083328          1.5         0.2     setosa
## 12      1.568616   1.2237754          1.6         0.2     setosa
## 13      1.568616   1.0986123          1.4         0.1     setosa
## 14      1.458615   1.0986123          1.1         0.1     setosa
## 15      1.757858   1.3862944          1.2         0.2     setosa
## 16      1.740466   1.4816045          1.5         0.4     setosa
## 17      1.686399   1.3609766          1.3         0.4     setosa
## 18      1.629241   1.2527630          1.4         0.3     setosa
## 19      1.740466   1.3350011          1.7         0.3     setosa
## 20      1.629241   1.3350011          1.5         0.3     setosa
## 21      1.686399   1.2237754          1.7         0.2     setosa
## 22      1.629241   1.3083328          1.5         0.4     setosa
## 23      1.526056   1.2809338          1.0         0.2     setosa
## 24      1.629241   1.1939225          1.7         0.5     setosa
## 25      1.568616   1.2237754          1.9         0.2     setosa
## 26      1.609438   1.0986123          1.6         0.2     setosa
## 27      1.609438   1.2237754          1.6         0.4     setosa
## 28      1.648659   1.2527630          1.5         0.2     setosa
## 29      1.648659   1.2237754          1.4         0.2     setosa
## 30      1.547563   1.1631508          1.6         0.2     setosa
## 31      1.568616   1.1314021          1.6         0.2     setosa
## 32      1.686399   1.2237754          1.5         0.4     setosa
## 33      1.648659   1.4109870          1.5         0.1     setosa
## 34      1.704748   1.4350845          1.4         0.2     setosa
## 35      1.589235   1.1314021          1.5         0.2     setosa
## 36      1.609438   1.1631508          1.2         0.2     setosa
## 37      1.704748   1.2527630          1.3         0.2     setosa
## 38      1.589235   1.2809338          1.4         0.1     setosa
## 39      1.481605   1.0986123          1.3         0.2     setosa
## 40      1.629241   1.2237754          1.5         0.2     setosa
## 41      1.609438   1.2527630          1.3         0.3     setosa
## 42      1.504077   0.8329091          1.3         0.3     setosa
## 43      1.481605   1.1631508          1.3         0.2     setosa
## 44      1.609438   1.2527630          1.6         0.6     setosa
## 45      1.629241   1.3350011          1.9         0.4     setosa
## 46      1.568616   1.0986123          1.4         0.3     setosa
## 47      1.629241   1.3350011          1.6         0.2     setosa
## 48      1.526056   1.1631508          1.4         0.2     setosa
## 49      1.667707   1.3083328          1.5         0.2     setosa
## 50      1.609438   1.1939225          1.4         0.2     setosa
## 51      1.945910   1.1631508          4.7         1.4 versicolor
## 52      1.856298   1.1631508          4.5         1.5 versicolor
## 53      1.931521   1.1314021          4.9         1.5 versicolor
## 54      1.704748   0.8329091          4.0         1.3 versicolor
## 55      1.871802   1.0296194          4.6         1.5 versicolor
## 56      1.740466   1.0296194          4.5         1.3 versicolor
## 57      1.840550   1.1939225          4.7         1.6 versicolor
## 58      1.589235   0.8754687          3.3         1.0 versicolor
## 59      1.887070   1.0647107          4.6         1.3 versicolor
## 60      1.648659   0.9932518          3.9         1.4 versicolor
## 61      1.609438   0.6931472          3.5         1.0 versicolor
## 62      1.774952   1.0986123          4.2         1.5 versicolor
## 63      1.791759   0.7884574          4.0         1.0 versicolor
## 64      1.808289   1.0647107          4.7         1.4 versicolor
## 65      1.722767   1.0647107          3.6         1.3 versicolor
## 66      1.902108   1.1314021          4.4         1.4 versicolor
## 67      1.722767   1.0986123          4.5         1.5 versicolor
## 68      1.757858   0.9932518          4.1         1.0 versicolor
## 69      1.824549   0.7884574          4.5         1.5 versicolor
## 70      1.722767   0.9162907          3.9         1.1 versicolor
## 71      1.774952   1.1631508          4.8         1.8 versicolor
## 72      1.808289   1.0296194          4.0         1.3 versicolor
## 73      1.840550   0.9162907          4.9         1.5 versicolor
## 74      1.808289   1.0296194          4.7         1.2 versicolor
## 75      1.856298   1.0647107          4.3         1.3 versicolor
## 76      1.887070   1.0986123          4.4         1.4 versicolor
## 77      1.916923   1.0296194          4.8         1.4 versicolor
## 78      1.902108   1.0986123          5.0         1.7 versicolor
## 79      1.791759   1.0647107          4.5         1.5 versicolor
## 80      1.740466   0.9555114          3.5         1.0 versicolor
## 81      1.704748   0.8754687          3.8         1.1 versicolor
## 82      1.704748   0.8754687          3.7         1.0 versicolor
## 83      1.757858   0.9932518          3.9         1.2 versicolor
## 84      1.791759   0.9932518          5.1         1.6 versicolor
## 85      1.686399   1.0986123          4.5         1.5 versicolor
## 86      1.791759   1.2237754          4.5         1.6 versicolor
## 87      1.902108   1.1314021          4.7         1.5 versicolor
## 88      1.840550   0.8329091          4.4         1.3 versicolor
## 89      1.722767   1.0986123          4.1         1.3 versicolor
## 90      1.704748   0.9162907          4.0         1.3 versicolor
## 91      1.704748   0.9555114          4.4         1.2 versicolor
## 92      1.808289   1.0986123          4.6         1.4 versicolor
## 93      1.757858   0.9555114          4.0         1.2 versicolor
## 94      1.609438   0.8329091          3.3         1.0 versicolor
## 95      1.722767   0.9932518          4.2         1.3 versicolor
## 96      1.740466   1.0986123          4.2         1.2 versicolor
## 97      1.740466   1.0647107          4.2         1.3 versicolor
## 98      1.824549   1.0647107          4.3         1.3 versicolor
## 99      1.629241   0.9162907          3.0         1.1 versicolor
## 100     1.740466   1.0296194          4.1         1.3 versicolor
## 101     1.840550   1.1939225          6.0         2.5  virginica
## 102     1.757858   0.9932518          5.1         1.9  virginica
## 103     1.960095   1.0986123          5.9         2.1  virginica
## 104     1.840550   1.0647107          5.6         1.8  virginica
## 105     1.871802   1.0986123          5.8         2.2  virginica
## 106     2.028148   1.0986123          6.6         2.1  virginica
## 107     1.589235   0.9162907          4.5         1.7  virginica
## 108     1.987874   1.0647107          6.3         1.8  virginica
## 109     1.902108   0.9162907          5.8         1.8  virginica
## 110     1.974081   1.2809338          6.1         2.5  virginica
## 111     1.871802   1.1631508          5.1         2.0  virginica
## 112     1.856298   0.9932518          5.3         1.9  virginica
## 113     1.916923   1.0986123          5.5         2.1  virginica
## 114     1.740466   0.9162907          5.0         2.0  virginica
## 115     1.757858   1.0296194          5.1         2.4  virginica
## 116     1.856298   1.1631508          5.3         2.3  virginica
## 117     1.871802   1.0986123          5.5         1.8  virginica
## 118     2.041220   1.3350011          6.7         2.2  virginica
## 119     2.041220   0.9555114          6.9         2.3  virginica
## 120     1.791759   0.7884574          5.0         1.5  virginica
## 121     1.931521   1.1631508          5.7         2.3  virginica
## 122     1.722767   1.0296194          4.9         2.0  virginica
## 123     2.041220   1.0296194          6.7         2.0  virginica
## 124     1.840550   0.9932518          4.9         1.8  virginica
## 125     1.902108   1.1939225          5.7         2.1  virginica
## 126     1.974081   1.1631508          6.0         1.8  virginica
## 127     1.824549   1.0296194          4.8         1.8  virginica
## 128     1.808289   1.0986123          4.9         1.8  virginica
## 129     1.856298   1.0296194          5.6         2.1  virginica
## 130     1.974081   1.0986123          5.8         1.6  virginica
## 131     2.001480   1.0296194          6.1         1.9  virginica
## 132     2.066863   1.3350011          6.4         2.0  virginica
## 133     1.856298   1.0296194          5.6         2.2  virginica
## 134     1.840550   1.0296194          5.1         1.5  virginica
## 135     1.808289   0.9555114          5.6         1.4  virginica
## 136     2.041220   1.0986123          6.1         2.3  virginica
## 137     1.840550   1.2237754          5.6         2.4  virginica
## 138     1.856298   1.1314021          5.5         1.8  virginica
## 139     1.791759   1.0986123          4.8         1.8  virginica
## 140     1.931521   1.1314021          5.4         2.1  virginica
## 141     1.902108   1.1314021          5.6         2.4  virginica
## 142     1.931521   1.1314021          5.1         2.3  virginica
## 143     1.757858   0.9932518          5.1         1.9  virginica
## 144     1.916923   1.1631508          5.9         2.3  virginica
## 145     1.902108   1.1939225          5.7         2.5  virginica
## 146     1.902108   1.0986123          5.2         2.3  virginica
## 147     1.840550   0.9162907          5.0         1.9  virginica
## 148     1.871802   1.0986123          5.2         2.0  virginica
## 149     1.824549   1.2237754          5.4         2.3  virginica
## 150     1.774952   1.0986123          5.1         1.8  virginica</code></pre>
</section>
<section id="summarise_if" class="slide level2">
<h2><code>summarise_if</code></h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The _if() variants apply a predicate function (a function that</span>
<span class="co"># returns TRUE or FALSE) to determine the relevant subset of</span>
<span class="co"># columns. Here we apply mean() to the numeric columns:</span>
starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_if</span>(is.numeric, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   height  mass birth_year
##    &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
## 1   174.  97.3       87.6</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#&gt; # A tibble: 1 x 3</span>
<span class="co">#&gt;   height  mass birth_year</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1   174.  97.3       87.6</span></code></pre></div>
</section>
<section id="multiple-grouped-transformations" class="slide level2">
<h2>Multiple grouped transformations</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># If you want to apply multiple transformations, use funs()</span>
by_species &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Species)

by_species <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_all</span>(<span class="kw">funs</span>(min, max))</code></pre></div>
<pre><code>## # A tibble: 3 x 9
##   Species    Sepal.Length_min Sepal.Width_min Petal.Length_min
##   &lt;fct&gt;                 &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;
## 1 setosa                  4.3             2.3              1  
## 2 versicolor              4.9             2                3  
## 3 virginica               4.9             2.2              4.5
## # ... with 5 more variables: Petal.Width_min &lt;dbl&gt;,
## #   Sepal.Length_max &lt;dbl&gt;, Sepal.Width_max &lt;dbl&gt;, Petal.Length_max &lt;dbl&gt;,
## #   Petal.Width_max &lt;dbl&gt;</code></pre>
</section>
<section id="more-complex-transformations" class="slide level2">
<h2>More complex transformations</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># You can express more complex inline transformations using .</span>
by_species <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_all</span>(<span class="kw">funs</span>(. <span class="op">/</span><span class="st"> </span><span class="fl">2.54</span>))</code></pre></div>
<pre><code>## # A tibble: 150 x 5
## # Groups:   Species [3]
##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
##  1         2.01        1.38        0.551      0.0787 setosa 
##  2         1.93        1.18        0.551      0.0787 setosa 
##  3         1.85        1.26        0.512      0.0787 setosa 
##  4         1.81        1.22        0.591      0.0787 setosa 
##  5         1.97        1.42        0.551      0.0787 setosa 
##  6         2.13        1.54        0.669      0.157  setosa 
##  7         1.81        1.34        0.551      0.118  setosa 
##  8         1.97        1.34        0.591      0.0787 setosa 
##  9         1.73        1.14        0.551      0.0787 setosa 
## 10         1.93        1.22        0.591      0.0394 setosa 
## # ... with 140 more rows</code></pre>
</section>
    </div>
  </div>

  <script src="part2_dplyr_files/reveal.js-3.3.0.1/lib/js/head.min.js"></script>
  <script src="part2_dplyr_files/reveal.js-3.3.0.1/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: false,
        // Transition style
        transition: 'none', // none/fade/slide/convex/concave/zoom
        // Transition style for full page slide backgrounds
        backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom



        // Optional reveal.js plugins
        dependencies: [
        ]
      });
    </script>
  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

<script>
  (function() {
    if (window.jQuery) {
      Reveal.addEventListener( 'slidechanged', function(event) {  
        window.jQuery(event.previousSlide).trigger('hidden');
        window.jQuery(event.currentSlide).trigger('shown');
      });
    }
  })();
</script>


  </body>
</html>
